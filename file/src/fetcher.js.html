<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <base data-ice="baseUrl" href="../../">
  <title data-ice="title">src/fetcher.js | API Document</title>
  <link type="text/css" rel="stylesheet" href="css/style.css">
  <link type="text/css" rel="stylesheet" href="css/prettify-tomorrow.css">
  <script src="script/prettify/prettify.js"></script>
  
  
</head>
<body class="layout-container">

<header>
  <a href="./">Home</a>
  <a href="identifiers.html">Identifier</a>
  <a href="source.html">Source</a>
  
  <a data-ice="repoURL" href="https://github.com/r7kamura/stackable-fetcher" class="repo-url-github">Repository</a>
  <div class="search-box">
  <span>
    <img src="./image/search.png">
    <span class="search-input-edge"></span><input class="search-input"><span class="search-input-edge"></span>
  </span>
    <ul class="search-result"></ul>
  </div>
</header>

<nav class="navigation" data-ice="nav">










</nav>

<div class="content" data-ice="content"><h1 data-ice="title">src/fetcher.js</h1>
<pre class="source-code line-number"><code class="prettyprint linenums" data-ice="content">var fetch = require(&apos;node-fetch&apos;);
var Request = require(&apos;./request&apos;)

/**
 * @class An HTTP Client
 * @property {object} adapter
 * @property {Array.&lt;object&gt;} middlewares
 * @example
 * new Fetcher().get(&apos;https://github.com&apos;).then(function (response) {
 *   console.log(response.status);
 *   return response;
 * });
 */
var Fetcher = function() {
  this.adapter = {
    call: function (environment) {
      return fetch(
        environment.url,
        {
          body: environment.body,
          headers: environment.headers,
          method: environment.method
        }
      );
    }
  };
  this.middlewares = [];
};

/**
 * @param {string}
 * @param {object=}
 * @param {object=}
 * @return {Promise}
 */
Fetcher.prototype.delete = function(url, parameters, headers) {
  return this._process(&apos;DELETE&apos;, url, null, headers, parameters);
};

/**
 * @param {string}
 * @param {object=}
 * @param {object=}
 * @return {Promise}
 */
Fetcher.prototype.get = function(url, parameters, headers) {
  return this._process(&apos;GET&apos;, url, null, headers, parameters);
};

/**
 * @param {string}
 * @param {object=}
 * @param {object=}
 * @return {Promise}
 */
Fetcher.prototype.head = function(url, parameters, headers) {
  return this._process(&apos;HEAD&apos;, url, null, headers, parameters);
};

/**
 * @param {string}
 * @param {*=}
 * @param {object=}
 * @return {Promise}
 */
Fetcher.prototype.options = function(url, body, headers) {
  return this._process(&apos;OPTIONS&apos;, url, body, headers);
};

/**
 * @param {string}
 * @param {*=}
 * @param {object=}
 * @return {Promise}
 */
Fetcher.prototype.patch = function(url, body, headers) {
  return this._process(&apos;PATCH&apos;, url, body, headers);
};

/**
 * @param {string}
 * @param {*=}
 * @param {object=}
 * @return {Promise}
 */
Fetcher.prototype.post = function(url, body, headers) {
  return this._process(&apos;POST&apos;, url, body, headers);
};

/**
 * @param {string}
 * @param {*=}
 * @param {object=}
 * @return {Promise}
 */
Fetcher.prototype.put = function(url, body, headers) {
  return this._process(&apos;PUT&apos;, url, body, headers);
};

/**
 * @param {Middleware}
 * @param {object=}
 * @return {Fetcher}
 */
Fetcher.prototype.use = function(middleware, options) {
  this.middlewares.push({ middleware: middleware, options: options });
  return this;
};

/**
 * @private
 * @param {object}
 * @return {object}
 */
Fetcher.prototype._buildApplication = function(request) {
  var application = this.adapter;
  var i = this.middlewares.length;
  while (i--) {
    application = new this.middlewares[i].middleware(
      application,
      this.middlewares[i].options
    );
  }
  return application;
};

/**
 * @private
 * @return {object}
 */
Fetcher.prototype._getApplication = function() {
  this._application = this._application || this._buildApplication();
  return this._application;
};

/**
 * @private
 * @param {string}
 * @param {string}
 * @param {string=}
 * @param {object=}
 * @param {object=}
 * @return {Promise}
 */
Fetcher.prototype._process = function(method, url, body, headers, parameters) {
  return this._getApplication().call(
    new Request(
      {
        body: body,
        headers: headers,
        method: method,
        parameters: parameters,
        url: url
      }
    ).toEnvironment()
  );
};

module.exports = Fetcher;
</code></pre>
</div>

<footer class="footer">
  Generated by <a href="https://esdoc.org">ESDoc<span data-ice="esdocVersion">(0.1.4)</span></a>
</footer>

<script src="script/search_index.js"></script>
<script src="script/search.js"></script>
<script src="script/pretty-print.js"></script>
<script src="script/inherited-summary.js"></script>
<script src="script/test-summary.js"></script>
<script src="script/inner-link.js"></script>
<script src="script/patch-for-local.js"></script>
</body>
</html>
